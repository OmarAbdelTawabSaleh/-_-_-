<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>اختبار توحيد الربوبية (25 سؤالاً مبسطاً)</title>
<style>
/* إضافة خط عربي مميز */
@import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap');

/* الألوان الجديدة */
:root {
    --primary-blue: #2980b9;
    --light-blue: #3498db;
    --accent-orange: #e67e22;
    --dark-orange: #d35400;
    --shadow-light: rgba(0, 0, 0, 0.1);
    --shadow-strong: rgba(0, 0, 0, 0.25);
    --gold-color: #ffd700; 
    --dark-gold: #c9a400;
}

body {
    font-family: 'Tajawal', 'Arial', sans-serif; 
    background-image: url('https://upload.wikimedia.org/wikipedia/commons/thumb/1/10/Islamic_Art_Pattern_02.svg/1280px-Islamic_Art_Pattern_02.svg.png'); 
    background-color: #f4f4f4;
    background-blend-mode: multiply; 
    background-size: 500px;
    background-repeat: repeat;
    opacity: 0.95;
    color: #333;
    line-height: 1.7;
    margin: 0;
    padding: 20px;
    direction: rtl; 
    text-align: right;
}

.quiz-container {
    max-width: 850px; 
    margin: 40px auto;
    background: rgba(255, 255, 255, 0.98); 
    padding: 30px;
    border-radius: 15px;
    box-shadow: 0 10px 30px var(--shadow-strong);
}

h1 {
    color: var(--primary-blue);
    text-align: center;
    border-bottom: 3px solid var(--light-blue);
    padding-bottom: 15px;
    margin-bottom: 30px;
    font-weight: 900; 
}

/* تنسيقات حقل الاسم والبدء */
#user-info-area input {
    width: 98%; 
    padding: 12px;
    margin-bottom: 20px;
    border: 1px solid #ccc;
    border-radius: 8px;
    box-shadow: inset 0 1px 3px var(--shadow-light);
    font-size: 1.1em; 
}
#start-btn {
    background: linear-gradient(135deg, var(--accent-orange) 0%, #f39c12 100%); 
    color: #fff;
    padding: 15px;
    border: none;
    border-radius: 8px;
    width: 100%;
    cursor: pointer;
    font-size: 1.2em;
    transition: all 0.3s;
    box-shadow: 0 4px 10px rgba(230, 126, 34, 0.4); 
}
#start-btn:hover {
    background: var(--dark-orange); 
    box-shadow: 0 6px 15px rgba(230, 126, 34, 0.6);
}

/* تنسيقات الاختبار */
#question-text {
    font-size: 1.3em;
    margin-bottom: 20px;
    padding: 20px;
    background-color: #eaf3f9; 
    border-right: 6px solid var(--light-blue); 
    border-radius: 8px;
    font-weight: bold;
    box-shadow: 0 2px 5px var(--shadow-light);
}

.options-list {
    list-style: none;
    padding: 0;
}

.option-item {
    background-color: #f9f9f9;
    margin-bottom: 12px;
    padding: 18px;
    border-radius: 8px;
    cursor: pointer;
    border: 1px solid #ddd;
    box-shadow: 0 1px 4px var(--shadow-light);
    transition: all 0.2s;
}

.option-item:hover {
    background-color: #fcf1e5; 
    border-color: var(--accent-orange); 
    transform: translateY(-2px); 
    box-shadow: 0 4px 8px var(--shadow-light);
}

.option-item.selected {
    background: linear-gradient(90deg, var(--light-blue) 0%, var(--primary-blue) 100%); 
    color: #fff;
    border-color: var(--primary-blue);
    font-weight: bold;
    box-shadow: 0 3px 8px rgba(41, 128, 185, 0.5);
}

/* تنسيق الأزرار (السابق/التالي/مراجعة) */
.quiz-controls {
    display: flex;
    gap: 15px;
    margin-top: 30px;
}

#submit-btn, #prev-btn {
    padding: 18px;
    border: none;
    border-radius: 8px;
    font-size: 1.2em;
    cursor: pointer;
    transition: background-color 0.3s;
    flex-grow: 1; 
}

#submit-btn {
    background-color: #2ecc71; 
    color: #fff;
    box-shadow: 0 3px 6px rgba(46, 204, 113, 0.4);
}
#submit-btn:hover {
    background-color: #27ae60;
}

#prev-btn {
    width: 150px; 
    background-color: #f39c12; 
    color: #333;
    box-shadow: 0 3px 6px rgba(243, 156, 18, 0.4);
}
#prev-btn:hover {
    background-color: var(--accent-orange);
}

#prev-btn:disabled {
    background-color: #bdc3c7; 
    color: #7f8c8d;
    cursor: not-allowed;
    box-shadow: none;
}

/* -------------------------------------- */
/* تنسيقات منطقة المراجعة (Review Area) */
/* -------------------------------------- */
#review-list {
    margin-top: 20px;
    padding: 0;
}

.review-question {
    background-color: #f8f8f8;
    border: 1px solid #eee;
    padding: 15px;
    margin-bottom: 15px;
    border-radius: 8px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-right: 5px solid var(--primary-blue);
}

.review-question strong {
    color: var(--dark-orange);
    font-size: 1.1em;
}

/* تنسيق زر التعديل في شاشة المراجعة */
.review-question button {
    background-color: var(--primary-blue);
    color: white;
    padding: 8px 15px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-weight: bold;
    transition: background-color 0.3s;
}

.review-question button:hover {
    background-color: #1a5273;
}

/* تنسيق أزرار إنهاء المراجعة */
.review-controls {
    display: flex;
    gap: 15px;
    margin-top: 30px;
}

#back-to-quiz-btn, #finish-quiz-btn {
    padding: 15px;
    border: none;
    border-radius: 8px;
    font-size: 1.1em;
    cursor: pointer;
    flex-grow: 1;
    font-weight: bold;
    transition: background-color 0.3s;
}

#back-to-quiz-btn {
    background-color: #f1c40f; 
    color: #333;
}
#back-to-quiz-btn:hover {
    background-color: #f39c12;
}

#finish-quiz-btn {
    background-color: #2ecc71; 
    color: white;
}
#finish-quiz-btn:hover {
    background-color: #27ae60;
}
/* -------------------------------------- */


/* تنسيقات الشهادة الجديدة (Results Card) */
.certificate-container {
    padding: 50px;
    background-color: #fff;
    border-radius: 15px;
    margin-top: 40px;
    box-shadow: 0 0 25px rgba(0, 0, 0, 0.3);

    /* الإطار المطلوب: خط مزدوج ذهبي يحيط من الاتجاهات الأربعة */
    border: 10px double var(--dark-gold); 
    
    /* جعل المحتوى داخله يتمحور في المنتصف */
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    
    /* إصلاح الإطار/المحتوى الأيسر وتجاوز العرض */
    overflow-x: hidden; 
    max-width: 100%; 
    box-sizing: border-box; 
}

.certificate-content {
    width: 90%; 
    margin: 0 auto;
    word-wrap: break-word; 
    max-width: 100%;
}

.certificate-header h2 {
    color: var(--primary-blue); 
    border-bottom: 4px solid var(--gold-color);
    padding-bottom: 15px;
    font-size: 2em; 
    margin-bottom: 25px;
    font-weight: 900;
}

.certificate-body p {
    font-size: 1.1em;
    margin-bottom: 15px;
    text-align: center;
}

.cert-line strong {
    color: var(--primary-blue);
}

#result-name {
    font-size: 1.8em; 
    color: var(--dark-orange);
    font-weight: bold;
    display: block;
    margin: 15px 0 20px 0;
    padding-bottom: 10px;
    border-bottom: 1px dashed #ccc;
    
    /* حل مشكلة تجاوز الاسم */
    width: 100%;
    overflow-wrap: break-word; 
    box-sizing: border-box;
}

.cert-result {
    font-size: 1.4em !important;
    font-weight: bold;
    color: #2ecc71;
}

.cert-message {
    font-size: 1.3em !important;
    font-style: italic;
    margin-top: 10px;
}

.certificate-footer {
    font-style: italic; 
    color: #7f8c8d;
    margin-top: 30px;
    border-top: 1px dashed #ccc;
    padding-top: 15px;
}


/* -------------------------------------- */
/* تنسيقات قائمة الأخطاء */
/* -------------------------------------- */
#incorrect-answers-area {
    width: 90%;
    margin-top: 30px;
    padding: 15px;
    border: 1px dashed #e74c3c;
    border-radius: 8px;
    text-align: right;
    display: none; 
}

#incorrect-answers-area h3 {
    color: #e74c3c;
    border-bottom: 1px solid #e74c3c;
    padding-bottom: 10px;
    margin-top: 0;
}

#incorrect-list {
    list-style: none;
    padding: 0;
}

#incorrect-list li {
    margin-bottom: 15px;
    padding: 10px;
    background-color: #fff5f5; 
    border-right: 5px solid #e74c3c;
    border-radius: 5px;
}

#incorrect-list li strong {
    color: var(--primary-blue); 
}

/* تنسيقات أزرار النتائج */
#print-certificate-btn {
    display: block;
    width: 100%;
    padding: 18px;
    background-color: var(--accent-orange); 
    color: #fff;
    border: none;
    border-radius: 8px;
    font-size: 1.2em;
    cursor: pointer;
    margin-top: 30px;
    transition: background-color 0.3s;
    box-shadow: 0 4px 10px rgba(230, 126, 34, 0.4);
}
#print-certificate-btn:hover {
    background-color: var(--dark-orange);
}

#whatsapp-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    width: 100%;
    padding: 15px;
    margin-top: 15px;
    background-color: #25d366; 
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 1.1em;
    cursor: pointer;
    transition: background-color 0.3s;
    font-weight: bold;
    box-shadow: 0 4px 10px rgba(37, 211, 102, 0.5); 
}

#whatsapp-btn:hover {
    background-color: #128c7e;
}

/* تنسيقات خاصة بالطباعة (الشهادة) */
@media print {
    body * {
        visibility: hidden;
    }
    #results-card, #results-card * {
        visibility: visible;
    }
    #results-card {
        position: absolute; 
        left: 0;
        top: 0;
        width: 90%;
        margin: 0;
        padding: 5% !important; 
        box-shadow: none;
        border: 15px double var(--dark-gold) !important;
    }
    #incorrect-answers-area {
        display: none !important; 
    }
    .quiz-container {
        box-shadow: none !important;
        background: none !important;
    }
    /* جعل المحتوى يملأ الصفحة في الطباعة */
    .certificate-content {
        width: 100% !important; 
    }
    /* إخفاء الأزرار عند الطباعة */
    #whatsapp-btn, .hadith-note, #print-certificate-btn {
        display: none !important; 
    }
}
</style>

</head>
<body>

<div class="quiz-container">
    <h1>✨ اختبار توحيد الربوبية (25 سؤالاً) ✨</h1>

    <div id="user-info-area">
        <label for="full-name">الاسم الثلاثي:</label>
        <input type="text" id="full-name" placeholder="أدخل اسمك الثلاثي هنا" required>
        <button id="start-btn">ابدأ الاختبار</button>
    </div>
    
    <div id="quiz-area" style="display: none;">
        <div class="question-counter" id="question-counter"></div>

        <p id="question-text">سؤال الاختبار سيظهر هنا.</p>
        
        <ul id="options-list" class="options-list">
            </ul>
        
        <div class="quiz-controls">
            <button id="prev-btn" disabled>السابق</button>
            <button id="submit-btn">السؤال التالي</button>
        </div>
    </div>
    
    <div id="review-area" style="display: none;">
        <h2>📝 مراجعة الإجابات</h2>
        <p style="text-align: center; font-style: italic;">يرجى مراجعة إجاباتك قبل إنهاء الاختبار. يمكنك النقر على زر "تعديل" للعودة إلى السؤال.</p>
        <div id="review-list">
            </div>
        
        <div class="review-controls">
            <button id="back-to-quiz-btn">🔙 تعديل الإجابات</button>
            <button id="finish-quiz-btn">✅ إنهاء الاختبار وعرض النتيجة</button>
        </div>
    </div>

    <div id="results-card" class="certificate-container" style="display: none;">
        
        <div class="certificate-content">
            <div class="certificate-header">
                <h2>📜 شهادة إتمام اختبار التوحيد 📜</h2>
                <p>تشهد **إدارة الموقع** بأن الطالب/ة:</p>
            </div>
            
            <div class="certificate-body">
                <p class="cert-line"><strong>الاسم:</strong> <span id="result-name"></span></p>
                <p class="cert-line"><strong>المادة:</strong> **أساسيات توحيد الربوبية**</p>
                <p class="cert-line">قد اجتاز الاختبار بنجاح بتاريخ <span id="result-date"></span> وحصل على الدرجة التالية:</p>
                <hr>
                <p class="cert-result">
                    **النتيجة النهائية:** <span id="result-score-text"></span>
                </p>
                <p class="cert-message">
                    **التقدير:** <span id="result-message"></span>
                </p>
            </div>

            <p class="certificate-footer">
                نسأل الله أن يجعل هذا العلم خالصاً لوجهه الكريم وأن يثبتنا وإياكم على التوحيد والسنة.
            </p>
        </div>

        <div id="incorrect-answers-area">
            <h3>⛔ الأخطاء التي وقعت فيها (للاستفادة والمراجعة)</h3>
            <ul id="incorrect-list"></ul>
        </div>
        
        <button id="print-certificate-btn">🖨️ طباعة الشهادة</button>
        
        <button id="whatsapp-btn" onclick="openWhatsApp()">
            🔗 WhatsApp: Contribute / اقترح تعديلات
        </button>
        <p class="hadith-note">
            الدال على الخير كفاعله. ومن دعا إلى هدى كان له من الأجر مثل أجور من تبعه... (نهاية الحديث).
        </p>
    </div>
</div>

<script>
    // 1. بيانات الأسئلة والأجوبة (توحيد الربوبية - 25 سؤالاً مبسطاً)
const quizData = [
    { question: "ما هو توحيد الربوبية؟", options: ["إفراد الله بالعبادة", "إفراد الله بأفعاله (كالخلق والرزق)", "إفراد الله في أسمائه", "إفراد الأنبياء بالصلاة"], userAnswer: null, correctAnswer: 1 },
    { question: "من هو الخالق الرازق المدبر لأمر الكون؟", options: ["الأولياء الصالحون", "الله وحده لا شريك له", "الملائكة المقربون", "الأنبياء والرسل"], userAnswer: null, correctAnswer: 1 },
    { question: "ما الدليل على أن الله هو المحيي والمميت؟", options: ["رؤية الكواكب تتحرك", "قوله تعالى: 'الَّذِي خَلَقَ الْمَوْتَ وَالْحَيَاةَ'", "كلام الفلاسفة", "تجارب العلماء"], userAnswer: null, correctAnswer: 1 },
    { question: "إفراد الله بالخلق والرزق والإحياء والإماتة يسمى توحيد:", options: ["الألوهية", "الربوبية", "الأسماء والصفات", "الحكم"], userAnswer: null, correctAnswer: 1 },
    { question: "هل خلق الكون جاء بالصدفة أم بتقدير من الخالق؟", options: ["بالصدفة", "بتقدير من الخالق العليم", "بفعل الطبيعة فقط", "بتدخل البشر"], userAnswer: null, correctAnswer: 1 },
    { question: "من هو المتحكم في نزول المطر وإنبات الزرع؟", options: ["الطقس فقط", "الله سبحانه وتعالى", "العلماء", "البشر"], userAnswer: null, correctAnswer: 1 },
    { question: "اعتراف الكفار بتوحيد الربوبية:", options: ["ينفعهم ويُدخلهم الجنة", "لا ينفعهم ما لم يُفردوا الله بالعبادة", "هو الأساس الوحيد للإيمان", "مكروه"], userAnswer: null, correctAnswer: 1 },
    { question: "ما معنى 'الرب' في توحيد الربوبية؟", options: ["المعبود المستحق للعبادة", "الخالق المالك المدبر", "الرسول المبعوث", "الصاحب والصديق"], userAnswer: null, correctAnswer: 1 },
    { question: "هل توحيد الربوبية وحده يكفي لدخول الإسلام؟", options: ["نعم، يكفي", "لا، لا بد من توحيد الألوهية معه", "يكفي للمؤمنين فقط", "يكفي للكفار"], userAnswer: null, correctAnswer: 1 },
    { question: "الذي يرى أن الطبيعة هي الخالق والمدبر، هل أتى بتوحيد الربوبية؟", options: ["نعم", "لا، هذا إنكار للربوبية", "جزئياً", "فقط إذا كان مؤمناً"], userAnswer: null, correctAnswer: 1 },
    { question: "من الذي بيده النفع والضر المطلق؟", options: ["الله وحده", "الأسباب المادية", "الأشخاص ذوو النفوذ", "الأطباء"], userAnswer: null, correctAnswer: 0 },
    { question: "لماذا لم يكُن إقرار كفار قريش بتوحيد الربوبية كافياً لنجاتهم؟", options: ["لأنهم لم يتركوا أموالهم", "لأنهم لم يقروا بتوحيد الألوهية (العبادة)", "لأنهم لم يصلوا", "لأنهم لم يصوموا"], userAnswer: null, correctAnswer: 1 },
    { question: "أفعال الله تعالى مثل: الخلق، والرزق، والإحياء، والإماتة تسمى:", options: ["توحيد الألوهية", "توحيد الربوبية", "توحيد الأسماء والصفات", "التوكل"], userAnswer: null, correctAnswer: 1 },
    { question: "من هو مالك الملك الذي يؤتي الملك من يشاء وينزع الملك ممن يشاء؟", options: ["رؤساء الدول", "الله جل جلاله", "الشعب", "الأمم المتحدة"], userAnswer: null, correctAnswer: 1 },
    { question: "قوله تعالى: 'اللَّهُ خَالِقُ كُلِّ شَيْءٍ' دليل على:", options: ["توحيد الألوهية", "توحيد الربوبية", "توحيد الأسماء", "القدر"], userAnswer: null, correctAnswer: 1 },
    { question: "هل يستطيع أحد من المخلوقين أن يرزق من عنده استقلالاً؟", options: ["نعم، يستطيعون", "لا يستطيعون، الرزق بيد الله وحده", "يستطيعون إذا أراد الله ذلك", "يستطيعون بمساعدة الأنبياء"], userAnswer: null, correctAnswer: 1 },
    { question: "من الذي يُسيِّر السحاب وينزّل به الماء؟", options: ["الرياح وحدها", "المناخ", "الله تعالى", "البخار"], userAnswer: null, correctAnswer: 2 },
    { question: "ما حكم من يعتقد أن هناك خالقاً غير الله أو شريكاً له في الخلق؟", options: ["مكروه", "كفر وشرك أكبر في الربوبية", "معصية صغيرة", "بدعة حسنة"], userAnswer: null, correctAnswer: 1 },
    { question: "ما معنى 'المدبِّر' في توحيد الربوبية؟", options: ["المعطي للمال", "المقسِّم للعبادة", "المتصرف في الكون وحده", "المعلم للبشر"], userAnswer: null, correctAnswer: 2 },
    { question: "أفعال العباد (مثل الصلاة والصيام) هي جزء من توحيد:", options: ["الربوبية", "الألوهية", "الأسماء والصفات", "القدر"], userAnswer: null, correctAnswer: 1 },
    { question: "من الذي يُنجي من الكربات ويُغيث المضطر؟", options: ["الناس الصالحون", "الله وحده لا شريك له", "الصدقات", "الأحداث الطبيعية"], userAnswer: null, correctAnswer: 1 },
    { question: "هل يمنع الإيمان بتوحيد الربوبية الأخذ بالأسباب؟", options: ["نعم، يمنع", "لا، بل يأمر بالأخذ بالأسباب والاعتماد على الله", "يمنع في بعض الحالات", "يمنع الكفار فقط"], userAnswer: null, correctAnswer: 1 },
    { question: "قوله تعالى: 'قُلْ مَن يَرْزُقُكُم مِّنَ السَّمَاءِ وَالْأَرْضِ' هو حُجَّة على المشركين في توحيد:", options: ["الألوهية", "الربوبية", "الأسماء والصفات", "الولاء والبراء"], userAnswer: null, correctAnswer: 1 },
    { question: "الاعتقاد بأن الأجرام السماوية (كالنجوم) تؤثر في حياتنا وتدبرها يُعتبر:", options: ["توحيد ربوبية", "شرك في الربوبية", "علم فلك عادي", "مستحب"], userAnswer: null, correctAnswer: 1 },
    { question: "لماذا أرسل الله الرسل؟", options: ["ليعرفوا الناس توحيد الربوبية فقط", "ليدعوا الناس إلى إفراد الله بالعبادة (الألوهية)", "ليعلموا الناس الزراعة", "ليبنوا البيوت"], userAnswer: null, correctAnswer: 1 }
];

// 2. المتغيرات الرئيسية
let currentQuestionIndex = 0;
let score = 0;
let userName = ''; 
let incorrectAnswers = []; 

// العناصر
const userInfoArea = document.getElementById('user-info-area');
const fullNameInput = document.getElementById('full-name');
const startButton = document.getElementById('start-btn');
const quizArea = document.getElementById('quiz-area');
const reviewArea = document.getElementById('review-area'); 
const reviewList = document.getElementById('review-list'); 
const resultsCard = document.getElementById('results-card'); 
const questionTextElement = document.getElementById('question-text');
const optionsListElement = document.getElementById('options-list');
const submitButton = document.getElementById('submit-btn');
const prevButton = document.getElementById('prev-btn'); 
const printButton = document.getElementById('print-certificate-btn'); 
const counterElement = document.getElementById('question-counter');
const incorrectListElement = document.getElementById('incorrect-list'); 
const finishQuizButton = document.getElementById('finish-quiz-btn'); 
const backToQuizButton = document.getElementById('back-to-quiz-btn'); 
const resultNameElement = document.getElementById('result-name'); // عنصر الاسم على الشهادة
const resultDateElement = document.getElementById('result-date'); // عنصر التاريخ على الشهادة
const resultScoreTextElement = document.getElementById('result-score-text'); // عنصر النتيجة على الشهادة
const resultMessageElement = document.getElementById('result-message'); // عنصر الرسالة/التقدير

// 3. دالة بدء الاختبار
startButton.addEventListener('click', () => {
    const name = fullNameInput.value.trim();
    if (name.length > 5) { 
        userName = name;
        userInfoArea.style.display = 'none'; 
        quizArea.style.display = 'block'; 
        currentQuestionIndex = 0;
        score = 0;
        incorrectAnswers = []; 
        quizData.forEach(q => q.userAnswer = null); 
        loadQuestion();
    } else {
        alert('من فضلك أدخل اسمك الثلاثي كاملاً لبدء الاختبار.');
    }
});


// 4. دالة تحميل السؤال
function loadQuestion() {
    if (currentQuestionIndex < quizData.length) {
        const currentQuestion = quizData[currentQuestionIndex];
        
        counterElement.textContent = `السؤال ${currentQuestionIndex + 1} من ${quizData.length}`;
        questionTextElement.textContent = currentQuestion.question;

        optionsListElement.innerHTML = '';
        currentQuestion.options.forEach((option, index) => {
            const listItem = document.createElement('li');
            listItem.textContent = option;
            listItem.classList.add('option-item');
            listItem.dataset.index = index; 
            listItem.addEventListener('click', () => selectAnswer(listItem, index));
            
            if (currentQuestion.userAnswer === index) {
                listItem.classList.add('selected');
            }

            optionsListElement.appendChild(listItem);
        });

        prevButton.disabled = currentQuestionIndex === 0;
        
        // **تحسين: تعديل نص زر التقدم حسب السياق**
        if (currentQuestionIndex === quizData.length - 1) {
            submitButton.textContent = 'مراجعة الإجابات';
        } else {
            submitButton.textContent = 'السؤال التالي';
        }
    } 
}

// 5. دالة اختيار الإجابة وحفظها
function selectAnswer(selectedItem, index) {
    document.querySelectorAll('.option-item').forEach(item => {
        item.classList.remove('selected');
    });
    selectedItem.classList.add('selected');
    quizData[currentQuestionIndex].userAnswer = index; 
    
    // **حل مشكلة العودة للتعديل:** يتم إزالة وضع المراجعة هنا ليعود الزر إلى وضعه الطبيعي
    if(submitButton.dataset.reviewMode === 'true') {
         // إزالة وضع المراجعة وإعادة تعيين النص
        submitButton.dataset.reviewMode = 'false';
        if (currentQuestionIndex === quizData.length - 1) {
            submitButton.textContent = 'مراجعة الإجابات';
        } else {
            submitButton.textContent = 'السؤال التالي';
        }
    }
    submitButton.disabled = false;
}

// 6. دالة معالجة الانتقال للأمام (Submit)
submitButton.addEventListener('click', () => {
    if (quizData[currentQuestionIndex].userAnswer === null) {
        alert('من فضلك اختر إجابة قبل الانتقال.');
        return;
    }

    if (currentQuestionIndex === quizData.length - 1) {
        showReviewScreen();
    } else {
        currentQuestionIndex++;
        loadQuestion();
    }
});

// 7. دالة معالجة الانتقال للخلف
prevButton.addEventListener('click', () => {
    if (currentQuestionIndex > 0) {
        currentQuestionIndex--;
        loadQuestion();
    }
});

// 8. دالة طباعة الشهادة
printButton.addEventListener('click', () => {
    window.print();
});

// دالة فتح الواتساب (تم التأكد من وجود كلمة WhatsApp)
function openWhatsApp() {
    const message = "WhatsApp: السلام عليكم ورحمة الله، أود أن أساهم في مراجعة أو تعديل اختبار توحيد الربوبية.";
    // رقم افتراضي (يرجى استبداله برقم حقيقي)
    const phoneNumber = "9665xxxxxxxx"; 
    window.open(`https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`, '_blank');
}
// جعل الدالة متاحة عالمياً لزر الـ HTML
window.openWhatsApp = openWhatsApp;

// دوال المراجعة
function showReviewScreen() {
    quizArea.style.display = 'none';
    reviewArea.style.display = 'block';
    window.scrollTo(0, 0); 
    
    reviewList.innerHTML = ''; 
    
    quizData.forEach((q, index) => {
        const reviewItem = document.createElement('div');
        reviewItem.classList.add('review-question');
        
        const selectedAnswerText = q.userAnswer !== null ? q.options[q.userAnswer] : 'لم تتم الإجابة';
        const isAnswered = q.userAnswer !== null;

        reviewItem.innerHTML = `
            <div>
                <strong>سؤال ${index + 1}:</strong> ${q.question}<br>
                <span class="review-answer" style="color: ${isAnswered ? '#2980b9' : '#e74c3c'}; font-weight: bold;">
                    الإجابة المختارة: ${selectedAnswerText}
                </span>
            </div>
        `;
        
        const editButton = document.createElement('button');
        editButton.textContent = 'تعديل';
        editButton.addEventListener('click', () => backToQuestion(index));
        
        reviewItem.appendChild(editButton);
        
        reviewList.appendChild(reviewItem);
    });
}

function backToQuestion(index) {
    reviewArea.style.display = 'none';
    quizArea.style.display = 'block';
    currentQuestionIndex = index;
    
    // **حل مشكلة ظهور زر المراجعة/التعديل:** وضع علامة
    submitButton.textContent = 'السؤال التالي';
    submitButton.dataset.reviewMode = 'true'; 
    
    loadQuestion();
}

backToQuizButton.addEventListener('click', () => {
    reviewArea.style.display = 'none';
    quizArea.style.display = 'block';
    currentQuestionIndex = quizData.length - 1; 
    loadQuestion(); 
});

finishQuizButton.addEventListener('click', () => {
    reviewArea.style.display = 'none';
    showResults();
});


// 💥 التعديل الرئيسي: دالة عرض النتائج المحدثة 💥
function showResults() {
    quizArea.style.display = 'none';
    resultsCard.style.display = 'block';
    
    // الانتقال لأعلى الشاشة عند عرض النتيجة
    window.scrollTo(0, 0); 

    score = 0;
    incorrectAnswers = [];
    quizData.forEach((q, index) => {
        // حساب النتيجة وتخزين الأخطاء
        if (q.userAnswer !== null && q.userAnswer === q.correctAnswer) {
            score++;
        } else if (q.userAnswer !== null && q.userAnswer !== q.correctAnswer) {
            incorrectAnswers.push({
                question: q.question,
                userAnswer: q.userAnswer !== null ? q.options[q.userAnswer] : 'لم تتم الإجابة',
                correctAnswer: q.options[q.correctAnswer]
            });
        }
    });

    // 1. حساب النسبة والرسالة
    const totalQuestions = quizData.length;
    const percentage = (score / totalQuestions) * 100;
    let message = '';

    if (percentage >= 90) {
        message = 'ممتاز! ما شاء الله لا قوة إلا بالله، لقد أبدعت.';
        resultMessageElement.style.color = '#27ae60';
    } else if (percentage >= 75) {
        message = 'جيد جداً! نتيجة طيبة، واصل مراجعتك.';
        resultMessageElement.style.color = '#f39c12';
    } else if (percentage >= 50) {
        message = 'مقبول. تحتاج لمزيد من المراجعة والتركيز على أساسيات التوحيد.';
        resultMessageElement.style.color = '#e67e22';
    } else {
        message = 'ضعيف. نرجو منك مراجعة المادة بالكامل والتركيز على العقيدة الصحيحة.';
        resultMessageElement.style.color = '#c0392b';
    }

    // 2. تحديث عناصر الشهادة
    const formattedDate = new Date().toLocaleDateString('ar-EG', { 
        year: 'numeric', month: 'long', day: 'numeric' 
    });

    resultNameElement.textContent = userName;
    resultDateElement.textContent = formattedDate;
    resultScoreTextElement.innerHTML = `${score} / ${totalQuestions} (${percentage.toFixed(1)}%)`;
    resultMessageElement.textContent = message;

    // 3. منطق عرض الأسئلة الخاطئة (الإصلاح المطلوب)
    incorrectListElement.innerHTML = ''; 
    const incorrectArea = document.getElementById('incorrect-answers-area');
    
    if (incorrectAnswers.length > 0) {
        incorrectArea.style.display = 'block';
        incorrectAnswers.forEach((item, index) => {
            const listItem = document.createElement('li');
            
            // تم استخدام تنسيق داخلي لضمان ظهور الألوان كما طلبت
            listItem.innerHTML = `
                <strong>السؤال ${index + 1}:</strong> ${item.question}<br>
                <span style="color: #e74c3c; font-weight: bold;">إجابتك:</span> ${item.userAnswer}<br>
                <span style="color: #27ae60; font-weight: bold;">الإجابة الصحيحة:</span> ${item.correctAnswer}
            `;
            incorrectListElement.appendChild(listItem);
        });
    } else {
        // إخفاء المنطقة إذا لم يكن هناك أخطاء
        incorrectArea.style.display = 'none';
    }
}
</script>

</body>
</html>
